---
title: "Next.js ã§ã¯ searchParams ã®æ‰±ã„ã«ã”ç”¨å¿ƒ"
emoji: ğŸ”¼
category: Tech
tags: [Next.js]
status: published
publishedAt: 2024-04-25
---

å½“ãƒ–ãƒ­ã‚°ã¯ä¸»ã« Next.js ã‚’ä½¿ã£ã¦æ§‹ç¯‰ã—ã¦ã„ã‚‹ï¼ˆç¾æ™‚ç‚¹ã§ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¯ `14.2.2`ï¼‰ã€‚
å…ˆæ—¥ã€ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸ã‹ã‚‰ [è¨˜äº‹ä¸€è¦§ãƒšãƒ¼ã‚¸](/posts) ã«é·ç§»ã™ã‚‹ã¨ãã«å°‘ã—ã‚‚ã£ã•ã‚Šã—ã¦ã„ã‚‹æ„Ÿã˜ãŒã—ãŸã€‚

ã“ã†ã„ã£ãŸæ„Ÿè¦šã¨ã„ã†ã®ã¯å¤§ä½“åˆã£ã¦ã„ã‚‹ã‚‚ã®ã§å¾Œã‹ã‚‰å•é¡ŒãŒè¦‹ã¤ã‹ã‚‹ãƒ‘ã‚¿ãƒ¼ãƒ³ãŒå¤šã„ã€‚
ãã“ã§æ€ªã—ã„ã¨æ€ã£ãŸã‚­ãƒ£ãƒƒã‚·ãƒ¥é–¢é€£ã‚’èª¿æŸ»ã—ã¦ã„ã‚‹ã¨ã€ãã‚‚ãã‚‚è¨˜äº‹ä¸€è¦§ãƒšãƒ¼ã‚¸ãŒ [å‹•çš„ Route](https://nextjs.org/docs/app/building-your-application/routing/dynamic-routes) ï¼ˆSSR ã®ä¸€ç¨®ï¼‰ã¨ã—ã¦ç”Ÿæˆã•ã‚Œã¦ã„ã‚‹ã“ã¨ãŒåˆ†ã‹ã£ãŸã€‚

ä»¥ä¸‹ãŒãƒ“ãƒ«ãƒ‰æ™‚ã®å‡ºåŠ›çµæœã€‚

```text
Route (app)                                               Size     First Load JS
â”Œ â—‹ /                                                     338 B           292 kB
...
â”œ Æ’ /posts                                                475 B           662 kB
â”œ â— /posts/[slug]                                         490 B           662 kB
â”œ   â”œ /posts/p1e0lpm
â”œ   â”œ /posts/p18vcqd
â”œ   â”œ /posts/p16vfnq
â”œ   â”” [+11 more paths]
...
â”” â—‹ /sitemap.xml                                          0 B                0 B
+ First Load JS shared by all                             87 kB
  â”œ chunks/313-7c44dae77fe97d18.js                        31.4 kB
  â”œ chunks/73ebd006-83408596cd117cc0.js                   53.6 kB
  â”” other shared chunks (total)                           1.93 kB

â—‹  (Static)   prerendered as static content
â—  (SSG)      prerendered as static HTML (uses getStaticProps)
Æ’  (Dynamic)  server-rendered on demand
```

`/posts` ã‚’è¦‹ã‚‹ã¨ `Æ’` ã¨ã‚ã‚Šã€ã“ã‚Œã¯å‹•çš„ Route ã§ç”Ÿæˆã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’è¡¨ã—ã¦ã„ã‚‹ï¼ˆå‰ã®è¨˜å·ã¯ `Î»` ã ã£ãŸã¨æ€ã†ãŒã€å®šç¾©ãŒå¤‰ã‚ã£ãŸã®ã‹ï¼Ÿï¼‰ã€‚
ç¾åœ¨ã®è¨˜äº‹ä¸€è¦§ãƒšãƒ¼ã‚¸ã¯ãŸã ã®ãƒªã‚¹ãƒˆã‚’è¡¨ç¤ºã•ã›ã¦ã„ã‚‹ã ã‘ãªã®ã§å‹•çš„ Route ã«ã™ã‚‹ãƒ¡ãƒªãƒƒãƒˆã¯å…¨ããªã„ã€‚

ã¾ãšã€é™çš„ Route ã‚’ä½¿ã†ã¨ä½•ãŒå¬‰ã—ã„ã®ã‹ã€‚
ãã‚Œã¯ TTFBï¼ˆTime To First Byteï¼‰ãŒçŸ­ç¸®ã•ã‚Œã€é«˜ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’å‡ºã›ã‚‹ç‚¹ã§ã‚ã‚‹ã€‚

é™çš„ Route ã§ã‚ã‚Œã°ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒç™ºç”Ÿã™ã‚‹å‰ã«ã‚µãƒ¼ãƒãŒãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã‚’è¡Œã†ã€‚
ã‚ã‚‰ã‹ã˜ã‚ç”Ÿæˆã•ã‚ŒãŸã‚­ãƒ£ãƒƒã‚·ãƒ¥ï¼ˆ[Full Route Cache](https://nextjs.org/docs/app/building-your-application/caching#full-route-cache)ï¼‰ã‚’ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã™ã‚‹ãŸã‚éå¸¸ã«åˆæœŸè¡¨ç¤ºãŒæ—©ã„ã€‚

ã‚‚ã—ã€ã“ã‚ŒãŒå‹•çš„ Route ã ã¨ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’å³åº§ã«ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã›ãšã«ã‚µãƒ¼ãƒã§ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã—ã¦ã‹ã‚‰ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã™ã‚‹ãŸã‚è‹¥å¹²ãƒ©ã‚°ãŒç™ºç”Ÿã™ã‚‹ã€‚

ã§ã¯ã€ãªãœé™çš„ Route ã§ç”Ÿæˆã•ã‚Œã‚‹ã¹ããƒšãƒ¼ã‚¸ãŒå‹•çš„ Route ã«ãªã£ã¦ã„ãŸã®ã‹ã€‚

åˆã‚ã¯ã©ã“ã‹ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ãƒ‡ãƒ¼ã‚¿å–å¾—ã‚’è¡Œã£ã¦ã„ã‚‹ã®ã§ã¯ãªã„ã‹ã¨è€ƒãˆãŸã€‚
å…¨ã¦ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’è¾¿ã£ã¦ã¿ãŸãŒã€ãã†ã„ã£ãŸç®‡æ‰€ã¯ãªã‹ã£ãŸã€‚

æ¶ˆå»æ³•ã§ `generateMetadata` ã‚’ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆã—ã¦ã‹ã‚‰ãƒ“ãƒ«ãƒ‰ã™ã‚‹ã¨ä»¥ä¸‹ã®ã‚ˆã†ãªå‡ºåŠ›çµæœã«ãªã£ãŸã€‚

```text
Route (app)                                               Size     First Load JS
â”Œ â—‹ /                                                     338 B           292 kB
...
â”œ â—‹ /posts                                                475 B           666 kB
â”œ â— /posts/[slug]                                         490 B           666 kB
â”œ   â”œ /posts/p1e0lpm
â”œ   â”œ /posts/p18vcqd
â”œ   â”œ /posts/p16vfnq
â”œ   â”” [+11 more paths]
...
â”” â—‹ /sitemap.xml                                          0 B                0 B
+ First Load JS shared by all                             87 kB
  â”œ chunks/313-7c44dae77fe97d18.js                        31.4 kB
  â”œ chunks/73ebd006-83408596cd117cc0.js                   53.6 kB
  â”” other shared chunks (total)                           1.93 kB

â—‹  (Static)   prerendered as static content
â—  (SSG)      prerendered as static HTML (uses getStaticProps)
Æ’  (Dynamic)  server-rendered on demand
```

ï¼ˆ`/posts` ãŒé™çš„ Route ã¨ã—ã¦ç”Ÿæˆã•ã‚Œã¦ã„ã‚‹ï¼‰

`generateMetadata` è‡ªä½“ã¯å‹•çš„ Route ã«ã‚¹ã‚¤ãƒƒãƒã•ã›ã‚‹ã‚ˆã†ãªé–¢æ•°ã§ã¯ãªã„ã€‚
æ„å¤–ãªçµæœãªã®ã ãŒã€`searchParams` ã‚’å‚ç…§ã™ã‚‹ã¨å¼·åˆ¶çš„ã«å‹•çš„ Route ã«ãªã£ã¦ã—ã¾ã†ã‚ˆã†ã§ã‚ã‚‹ã€‚

`page.tsx` ã§æ¸¡ã•ã‚Œã‚‹ `params` ã¯ `generateStaticParams`[^1] ã§æŒ‡å®šã™ã‚Œã° SSG ã«ã§ãã‚‹ãŒã€`searchParams` ã¯æŒ‡å®šã§ããªã„ã€‚
ãã‚Œã‚†ãˆã€`searchParams` ã‚’ä½¿ã†ã ã‘ã§ã¯å‹•çš„ Route ã«ã¯ãªã‚‰ãªã„ã¨ã„ã†æ€ã„è¾¼ã¿ãŒã‚ã£ãŸã®ãŒä»Šå›ã®åçœã ã€‚

[^1]: `generateStaticParams` é–¢æ•°ã‚’ä½¿ã†ã¨æŒ‡å®šã•ã‚ŒãŸãƒ‘ã‚¹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¯ãƒ“ãƒ«ãƒ‰æ™‚ã« SSG ãŒå®Ÿè¡Œã•ã‚Œã‚‹ã€‚é€†ã«æŒ‡å®šã—ãªã‘ã‚Œã°ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ™‚ã« SSG ãŒå®Ÿè¡Œã•ã‚Œã‚‹ã®ã§ã§ãã‚‹ã ã‘æŒ‡å®šã—ãŸæ–¹ãŒè‰¯ã„

å…ƒã® `generateMetadata` ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã£ã¦ã„ãŸã€‚

```ts title="page.tsx" showLineNumbers
export const generateMetadata = ({ searchParams }: { searchParams: Record<string, string | string[] | undefined> }) => {
  const category = (searchParams.category as string) ?? 'blog';
  return {
    title: `${category.charAt(0).toUpperCase()}${category.slice(1)}`,
    description: 'Blog posts of Keisuke Hayashi.',
    alternates: {
      canonical: '/posts',
    },
    openGraph: {
      url: '/posts',
    },
  } satisfies Metadata;
};
```

ã“ã‚Œã¯ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®å€¤ã«ã‚ˆã£ã¦ãƒšãƒ¼ã‚¸ã‚¿ã‚¤ãƒˆãƒ«ã‚’å‹•çš„ã«å¤‰æ›´ã—ãŸãã¦ã“ã®å½¢ã«ã—ãŸã€‚
ä¾‹ãˆã° `https://kkhys.me/posts?category=tech` ã¨ã„ã† URL ã§ã‚ã‚Œã°ã‚¿ã‚¤ãƒˆãƒ«ã¯ `Tech` ã«ãªã‚‹ã€‚

çµæœçš„ã«å¯¾ç—‡ç™‚æ³•ã¨ã—ã¦ä»¥ä¸‹ã®ã‚ˆã†ã«ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’è¨­å®šã™ã‚‹ã“ã¨ã«ã—ãŸã€‚

```ts title="page.tsx" showLineNumbers
export const metadata = {
  title: 'Blog',
  description: 'Blog posts of Keisuke Hayashi.',
  alternates: {
    canonical: '/posts',
  },
  openGraph: {
    url: '/posts',
  },
} satisfies Metadata;
```

é™çš„ Route ã‹ã¤ãƒšãƒ¼ã‚¸ã‚¿ã‚¤ãƒˆãƒ«ã‚’å‹•çš„ã«å¤‰æ›´ã—ãŸã‘ã‚Œã° `https://kkhys.me/posts/tech` ã®ã‚ˆã†ãª URL ã«ã™ã‚‹ã—ã‹ãªã„ã€‚
ã“ã‚Œã ã¨ã‚ã¾ã‚Šç¾ã—ããªã„ã‹ã‚‰ URL è¨­è¨ˆã‚’è¦‹ç›´ã•ãªã‘ã‚Œã°ãªã‚‰ãªã„ã€‚

Next.js ã¯ä¾¿åˆ©ã ãŒã€ã“ã†ã„ã£ãŸè¦ç´„ã‚’å¼·åˆ¶ã•ã›ã‚‰ã‚Œã‚‹ç‚¹ãŒã‚¤ãƒã‚¤ãƒãªã¨ã“ã‚ã ã€‚
ä»Šå¾Œ `generateStaticParams` ã§ `searchParams` ã‚’è¨­å®šã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ã¨è‰¯ã„ã‘ã©ã€ãã®å¯èƒ½æ€§ã¯ä½ã„ã‹ã‚‚ã—ã‚Œãªã„ã€‚

ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ `searchParams` ã®å€¤ãŒå¿…è¦ãªå ´åˆã¯ `page.tsx` ã® props ã‹ã‚‰å¼•ã£å¼µã£ã¦ãã‚‹ã®ã§ã¯ãªãã€`useSearchParams` ã‚’ä½¿ã£ã¦ CSR ã§ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã™ã‚‹æ–¹ãŒå ´åˆã«ã‚ˆã£ã¦ã¯æœ‰åŠ¹ã€‚

ä»Šå›ã®ä»¶ã«ã¤ã„ã¦ã¯ [reddit](https://www.reddit.com/r/nextjs/comments/15dnnv4/nextjs_13_static_searchparams) ãŒå‚è€ƒã«ãªã£ãŸã€‚
æœ€è¿‘ã¯ Stack Overflow ã‚ˆã‚Šã‚‚ reddit ã®æ–¹ãŒæœ‰ç›Šãªæƒ…å ±ãŒè½ã¡ã¦ã„ã‚‹ã“ã¨ãŒå¤šã„ã‚ˆã†ã«æ„Ÿã˜ã‚‹ã€‚

ã¾ãŸã€Next.js ãƒªãƒã‚¸ãƒˆãƒªã®ã“ã® [Issue](https://github.com/vercel/next.js/issues/49735) ã‚‚å‚è€ƒã«ãªã‚‹ã€‚
